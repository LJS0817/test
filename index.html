<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
</head>
<body>
    <canvas id="canvas"></canvas>   
    <script>
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');

        canvas.width = 480;
        canvas.height = 720;

        context.fillRect(0, 0, canvas.width, canvas.height);

        class Vector2D {
            constructor(x = 0, y = 0) {
                this.x = x;
                this.y = y;
            }
        }

        class Unit {
            constructor(position, velocity, color, speed = 7) {
                this.size = 50;
                this.speed = speed;
                this.color = color;
                this.position = position;
                this.velocity = velocity;
                this.half = this.size / 2;
            }

            Update() {
                context.fillStyle = this.color;
                var half = this.size / 2;
                context.fillRect(this.position.x - half, this.position.y - half, this.size, this.size);
                this.position.x += this.velocity.x;
                this.position.y += this.velocity.y;
            }

            Collision() {

            }
        }

        var bullet = [];

        class Bullet extends Unit {
            constructor(position) {
                super(position, new Vector2D(0, 0), 'blue', 13);
                this.velocity.y = -this.speed;
                this.size = 10;
            }

            Update() {
                super.Update();
                this.Collision();
            }

            Collision() {
                if(this.position.y <= -10) {
                    bullet.shift();
                }
            }
        }

        class Hero extends Unit {
            constructor() {
                super(new Vector2D(canvas.width / 2, canvas.height / 2), new Vector2D(0, 0), 'red')
                this.keys = {
                    w: false,
                    a: false,
                    s: false,
                    d: false,
                    space: false,
                }
            }

            Update() {
                super.Update();
                if(this.keys.w) this.velocity.y = -this.speed;
                else if(this.keys.s) this.velocity.y = this.speed;
                else if(this.velocity.y != 0) this.velocity.y = 0;

                if(this.keys.a) this.velocity.x = -this.speed;
                else if(this.keys.d) this.velocity.x = this.speed;
                else if(this.velocity.x != 0) this.velocity.x = 0;
                
                if(this.keys.space) {
                    var b = new Bullet(new Vector2D(this.position.x, this.position.y));
                    bullet.push(b);
                }
                
                this.Collision();
            }

            Collision() {
                if(this.position.x <= this.half) this.position.x = this.half;
                if(this.position.x >= canvas.width - this.half) this.position.x = canvas.width - this.half;
                if(this.position.y <= this.half) this.position.y = this.half;
                if(this.position.y >= canvas.height - this.half) this.position.y = canvas.height - this.half;
            }
        }

        var hero = new Hero();

        function Update() {
            window.requestAnimationFrame(Update);
            context.fillStyle = 'black'
            context.fillRect(0, 0, canvas.width, canvas.height);
            hero.Update();
            bullet.forEach(function(item) {
                item.Update();
            })
        }

        Update();

        window.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'w':
                    hero.keys.w = true;
                    break;
                case 'd':
                    hero.keys.d = true;
                    break;
                case 'a':
                    hero.keys.a = true;
                    break;
                case 's':
                    hero.keys.s = true;
                    break;
                case ' ':
                    hero.keys.space = true;
                    break;
            }
        })

        window.addEventListener('keyup', function(e) {
            switch(e.key) {
                case 'w':
                    hero.keys.w = false;
                    break;
                case 'd':
                    hero.keys.d = false;
                    break;
                case 'a':
                    hero.keys.a = false;
                    break;
                case 's':
                    hero.keys.s = false;
                    break;
                case ' ':
                    hero.keys.space = false;
                    break;
            }
        })
    </script>
</body>
</html>